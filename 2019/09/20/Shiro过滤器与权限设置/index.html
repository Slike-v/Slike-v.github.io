<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Shiro过滤器与权限设置"><meta name="keywords" content="Shiro过滤器与权限设置"><meta name="author" content="Slike-V,undefined"><meta name="copyright" content="Slike-V"><title>Shiro过滤器与权限设置【Slikeの后花园】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/avatar.png"><!-- script(src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML")--><script src="/js/mathjax/mathjax.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Shiro过滤器与权限设置"><span class="toc-number">1.</span> <span class="toc-text">Shiro过滤器与权限设置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#nbsp-nbsp-nbsp-nbsp-nbsp-nbsp-nbsp-前言"><span class="toc-number">1.0.1.</span> <span class="toc-text">       前言</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#过滤器链与拦截规则"><span class="toc-number">1.0.2.</span> <span class="toc-text">过滤器链与拦截规则</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">Slike-V</div><div class="author-info-description"></div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/fan-lv" target="_blank">GitHub<i class="icon-dot bg-color3"></i></a><a class="links-button button-hover" href="mailto:826330335@qq.com" target="_blank">E-Mail<i class="icon-dot bg-color8"></i></a><a class="links-button button-hover" href="tencent:/" target="_blank">QQ<i class="icon-dot bg-color7"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">59</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">59</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">19</span></a></div><div class="friend-link"><a class="friend-link-text" href="/about" target="_blank">Slike-V【简介】</a><a class="friend-link-text" href="https://github.com/fan-lv" target="_blank">主题作者</a><a class="friend-link-text" href="http://kublic.coding.me" target="_blank">Kubil博客</a><a class="friend-link-text" href="http://mebieber.coding.me" target="_blank">Mebieber博客</a><a class="friend-link-text" href="https://www.ultarts.com" target="_blank">Ultarts博客</a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="title-name" href="/">Slikeの后花园</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">Shiro过滤器与权限设置</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2019-09-20 | 更新于 2021-07-28</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Shiro框架/">Shiro框架</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/Shiro过滤器与权限设置/">Shiro过滤器与权限设置</a></div></div></div><div class="main-content"><h3 id="Shiro过滤器与权限设置"><a href="#Shiro过滤器与权限设置" class="headerlink" title="Shiro过滤器与权限设置"></a>Shiro过滤器与权限设置</h3><h5 id="nbsp-nbsp-nbsp-nbsp-nbsp-nbsp-nbsp-前言"><a href="#nbsp-nbsp-nbsp-nbsp-nbsp-nbsp-nbsp-前言" class="headerlink" title="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;前言"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;前言</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Shiro对于Web类型的软件项目，Shiro框架的内部运行强烈依赖于Servlet技术规范中的Filter（过滤器），因此内部提供了包括认证、授权、管理等各个环节非常多的过滤器。因此了解过滤器及配置规则尤其重要。</p>
<hr>
<a id="more"></a>
<h5 id="过滤器链与拦截规则"><a href="#过滤器链与拦截规则" class="headerlink" title="过滤器链与拦截规则"></a>过滤器链与拦截规则</h5><p><img src="/images/pasted-189.png" alt="upload successful"></p>
<p>以上是Shiro中的一些重要的过滤器。不过最终都是继承在Filter接口、而Filter接口是在javax.servlet;包中。</p>
<ol>
<li><p>NameableFilter</p>
<p> 给 Filter 起个名字，如果没有设置默认就是 FilterName；还记得之前的如 authc 吗？当我们组装拦截器链时会根据这个名字找到相应的拦截器实例。</p>
</li>
<li><p>OncePerRequestFilter</p>
<p> 用于防止多次执行 Filter 的；也就是说一次请求只会走一次拦截器链；另外提供enabled 属性，表示是否开启该拦截器实例，默认 enabled=true 表示开启，如果不想让某个拦截器工作，可以设置为 false 即可。大部分 Shiro 过滤器都是该过滤器的子类。</p>
</li>
<li><p>ShiroFilter</p>
<p> 是整个 Shiro 框架的入口点，用于拦截需要安全控制的请求进行处理。</p>
</li>
<li><p>AdviceFilter</p>
<p> 提供了 AOP 风格的支持，类似于 SpringMVC 中的 Interceptor（拦截器）提供的preHandler 方法类似于 AOP 中的前置增强；在拦截器链执行之前执行；如果返回 true 则继续拦截器链；否则中断后续的拦截器链的执行直接返回；进行预处理（如基于表单的身份验证、授权）；postHandle 方法类似于 AOP 中的后置返回增强；在拦截器链执行完成后执行；进行后处理（如记录执行时间之类的）；afterCompletion 方法类似于 AOP 中的后置最终增强；即不管有没有异常都会执行；可以进行清理资源（如接触 Subject 与线程的绑定之类的）。</p>
</li>
<li><p>PathMatchingFilter</p>
<p> 提供了基于 Ant 风格的请求路径匹配功能及拦截器参数解析的功能，如“roles[admin,user]”自动根据“,”分割解析到一个路径参数配置并绑定到相应的路径。</p>
</li>
<li><p>AccessControlFilter</p>
<p> 提供了访问控制的基础功能；比如是否允许访问/当访问拒绝时如何处理等。isAccessAllowed 方法表示是否允许访问；mappedValue 就是[urls]配置中拦截器参数部分，如果允许访问返回 true，否则 false；onAccessDenied 方法表示当访问拒绝时是否已经处理了；如果返回 true 表示需要继续处理；如果返回 false 表示该拦截器实例已经处理了，将直接返回即可；onPreHandle 方法会自动调用这两个方法决定是否继续处理。如果我们想进行访问访问的控制就可以继承 AccessControlFilter；如果我们要添加一些通用数据我们可以直接继承 PathMatchingFilter。</p>
</li>
</ol>
<ul>
<li><p>内置过滤器</p>
<p>  Shiro内置了很多默认的过滤器，比如身份验证、授权等相关的。默认过滤器可以参考org.apache.shiro.web.filter.mgt.DefaultFilter 中的枚举。而这些默认的过滤器。默认都是开启状态。可以直接在 ini 配置文件中通过 “拦截器名. 属性” 设置其属性。</p>
<p>  <img src="/images/pasted-190.png" alt="upload successful"></p>
<p>  如果不想使用某个拦截器，可以直接通过如下配置直接禁用：</p>
<pre><code>//禁用perms权限
perms.enabled=false</code></pre></li>
</ul>
<table>
<thead>
<tr>
<th align="center">默认过滤器名</th>
<th align="center">指定类名</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">认证过滤器</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">authc</td>
<td align="center">FormAuthenticationFilter—基于表单的过滤器；</td>
<td align="center">如“<code>/**=authc</code>”没有登录会跳到相应页登录；主要属性：usernameParam:表单提交的用户名参数；passwordParam:表单提交的密码参数；rememberMeParam：表单提交叫记住我;loginUrl：登录页地址；successUrl登录成功后的默认重定向地址；failureKeyAttribute：登录失败后错误信息存储key（shiroLoginFailure）；</td>
</tr>
<tr>
<td align="center">authc Basic</td>
<td align="center">BasicHttpAuthenticationFilter—HTTP身份验证过滤器</td>
<td align="center">主要属性：applicationName：弹出登录框显示的信息（application）；</td>
</tr>
<tr>
<td align="center">logout</td>
<td align="center">LogoutFilter—退出过滤器</td>
<td align="center">主要属性：redirectUrl：退出成功后重定向的地址（/）;示例“/logout=logout”</td>
</tr>
<tr>
<td align="center">user</td>
<td align="center">UserFilter—用户过滤器</td>
<td align="center">用户已经身份验证/记住我登录的都可；示例 “<code>/**=user</code>”</td>
</tr>
<tr>
<td align="center">anon</td>
<td align="center">AnonymousFilter—匿名过滤器</td>
<td align="center">即不需要登录即可访问；一般用于静态资源过滤；示例 “<code>/static/**=anon</code>”</td>
</tr>
<tr>
<td align="center">授权过滤器</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">roles</td>
<td align="center">RolesAuthorizationFilter—角色授权过滤器</td>
<td align="center">验证用户是否拥有所有角色；主要属性：loginUrl：登录页面地址（/login.jsp）；unauthorizedUrl：未授权后重定向的地址；示例“<code>/admin/**=roles[admin]</code>”</td>
</tr>
<tr>
<td align="center">perms</td>
<td align="center">PermissionsAuthorizationFilter—权限授权过滤器</td>
<td align="center">验证用户是否拥有所有权限；属性和 roles 一样；示例“<code>/user/**=perms[&quot;user:create&quot;]</code>”</td>
</tr>
<tr>
<td align="center">host</td>
<td align="center">HostFilter—即主机过滤器</td>
<td align="center">比如其提供了属性：authorizedIps：已授权的 ip 地址，deniedIps：表示拒绝的 ip 地址；不过目前还没有完全实现，不可用。</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">PortFilter—端口过滤器</td>
<td align="center">主要属性：port（80）：可以通过的端口；示例 “<code>/test= port[80]</code>”，如果用户访问该页面是非 80，将自动将请求端口改为80并重定向到该80端口，其他路径/参数等都一样</td>
</tr>
<tr>
<td align="center">rest</td>
<td align="center">HttpMethodPermissionFilter—rest风格过滤器</td>
<td align="center">自动根据请求方法构建权限字符串（GET=read, POST=create,PUT=update,DELETE=delete,HEAD=read,TRACE=read,OPTIONS=read, MKCOL=create）构建权限字符串；示例“/users=rest[user]”，会自动拼出“user:read,user:create,user:update,user:delete”权限字符串进行权限匹配（所有都得匹配，isPermittedAll）；</td>
</tr>
<tr>
<td align="center">ssl</td>
<td align="center">slFilter—SSL过滤器</td>
<td align="center">只有请求协议是https才能通过；否则自动跳转会 https 端口（443）；其他和port过滤器一样；</td>
</tr>
<tr>
<td align="center">其它过滤器</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">noSessionCreati on</td>
<td align="center">NoSessionCreationFilter—不创建会话过滤器</td>
<td align="center">调用 subject.getSession(false)不会有什么问题，但是如果subject.getSession(true)将抛出DisabledSessionException 异常；</td>
</tr>
</tbody></table>
<ul>
<li><p>拦截规则语法</p>
<p>  同过前面的示例可知，Shiro 过滤器链的拦截规则在 ini 文件、Java 代码、properties 文件、Spring XML 中都可以配置，本质上都是 Key-Value 的写法。</p>
<p> SpringBoot配置类添加权限规则</p>
<p>  <img src="/images/pasted-191.png" alt="upload successful"></p>
<p> SpringXML添加权限规则</p>
<p>  <img src="/images/pasted-192.png" alt="upload successful"></p>
<p> .ini配置添加权限规则</p>
<p>  <img src="/images/pasted-193.png" alt="upload successful"></p>
<p>  对于权限中的还有一些属性，可以使用过滤器名.属性的方式使用属性。如：<code>perms.unauthorizedUrl=/unauthorized</code></p>
</li>
</ul>
</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Slike-V</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="http://Slike-v.github.io/2019/09/20/Shiro过滤器与权限设置/">http://Slike-v.github.io/2019/09/20/Shiro过滤器与权限设置/</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://Slike-v.github.io">Slikeの后花园</a>！</span></div></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2019/09/23/kaptcha验证码实现/"><i class="fas fa-angle-left">&nbsp;</i><span>kaptcha验证码实现</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2019/09/19/Shiro之密码加密/"><span>Shiro之密码加密</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2017 ～ 2021 By Slike-V</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--></body></html>